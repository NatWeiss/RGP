<!DOCTYPE html>

<html>
<head>
  <title>App.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>App.js</h1>
        

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="README.html">
                    README.md
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="App.html">
                    App.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Config.html">
                    Config.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="ConfigServer.html">
                    ConfigServer.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="HelloJavascript.html">
                    HelloJavascript.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Loader.html">
                    Loader.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="SceneHello.html">
                    SceneHello.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="AdsMobFox.html">
                    AdsMobFox.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Facebook.html">
                    Facebook.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Server.html">
                    Server.js
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>

      
        
        
        
      
        
        <p>The main App object is a singleton providing boot code, main functions, and other commonly-used, globally-accessible methods.</p>
<ol>
<li>All code in this file is applicable to any game project in general.</li>
<li>If you need to extend the App object with project-specific code, use <a href="HelloJavascript.html">HelloJavascript.js</a>.</li>
</ol>

        
      
        
        <h3 id="app">App</h3>
<p>Get or create the App object.</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> App = App || {};</pre></div>
        
      
        
        <h3 id="app-getinitialscene">App.getInitialScene</h3>
<p>Return the initial Scene class.</p>

        
          <div class='highlight'><pre>App.getInitialScene = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">return</span> SceneHello;
};</pre></div>
        
      
        
        <h3 id="app-gettargetframerate">App.getTargetFrameRate</h3>
<p>Return the target frame rate to use. Scale back in HTML5 mode to save a CPU fan somewhere.</p>

        
          <div class='highlight'><pre>App.getTargetFrameRate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.isHtml5() ? <span class="hljs-number">30</span> : <span class="hljs-number">60</span>;
};</pre></div>
        
      
        
        <h3 id="app-ishtml5">App.isHtml5</h3>
<p>Return true if the app is running in HTML5 mode.</p>

        
          <div class='highlight'><pre>App.isHtml5 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._isHtml5 === <span class="hljs-string">"undefined"</span>) {
		App.assert(cc.sys);
		<span class="hljs-keyword">this</span>._isHtml5 = cc.sys.isNative ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;
	}
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._isHtml5;
};</pre></div>
        
      
        
        <h3 id="app-isdesktop">App.isDesktop</h3>
<p>Return true if the app is running on a native desktop OS.</p>

        
          <div class='highlight'><pre>App.isDesktop = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._isDesktop === <span class="hljs-string">"undefined"</span>) {
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isHtml5()) {
			<span class="hljs-keyword">this</span>._isDesktop = <span class="hljs-literal">false</span>;
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">this</span>._isDesktop = (cc.sys.os === cc.sys.OS_OSX
				|| cc.sys.os === cc.sys.OS_WINDOWS
				|| cc.sys.os === cc.sys.OS_LINUX);
		}
	}
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._isDesktop;
};</pre></div>
        
      
        
        <h3 id="app-rand">App.rand</h3>
<p>Return a random integer between 0 and the given value.</p>

        
          <div class='highlight'><pre>App.rand = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(mod)</span> {</span>
	<span class="hljs-keyword">var</span> r = <span class="hljs-built_in">Math</span>.random();
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> mod !== <span class="hljs-string">'undefined'</span>) {
		r *= <span class="hljs-number">0xffffff</span>;
		r = <span class="hljs-built_in">parseInt</span>(r);
		r %= mod;
	}
	<span class="hljs-keyword">return</span> r;
};</pre></div>
        
      
        
        <h3 id="app-getwinsize">App.getWinSize</h3>
<p>Return the current size of the window or screen.</p>

        
          <div class='highlight'><pre>App.getWinSize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> size = cc.director.getWinSizeInPixels();
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._winSize === <span class="hljs-string">'undefined'</span> || (size.width &amp;&amp; size.height)) {
		<span class="hljs-keyword">this</span>._winSize = size;
	}
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._winSize;
};</pre></div>
        
      
        
        <h3 id="app-getresourcedir">App.getResourceDir</h3>
<p>Return the resource directory (SD, HD or HDR) for this device’s resolution.</p>

        
          <div class='highlight'><pre>App.getResourceDir = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._resourceDir === <span class="hljs-string">"undefined"</span>) {
		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
			winSize = <span class="hljs-keyword">this</span>.getWinSize(),
			maxDimension = <span class="hljs-built_in">Math</span>.max(winSize.width, winSize.height),
			minDimension = <span class="hljs-built_in">Math</span>.min(winSize.width, winSize.height),
			setResourceDir = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dir, contentScaleFactor, scaleFactor)</span>{</span>
				self._resourceDir = dir;
				self._contentScaleFactor = contentScaleFactor;
				self._scaleFactor = scaleFactor;
			};
		
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isHtml5()) {
			<span class="hljs-keyword">if</span> (minDimension &gt;= <span class="hljs-number">600</span>) {
				setResourceDir(<span class="hljs-string">"res/hd"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
			} <span class="hljs-keyword">else</span> {
				setResourceDir(<span class="hljs-string">"res/sd"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">.5</span>);
			}
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">if</span> (maxDimension &gt; <span class="hljs-number">1600</span>) {
				setResourceDir(<span class="hljs-string">"res/hdr"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (maxDimension &gt;= <span class="hljs-number">960</span>) {
				setResourceDir(<span class="hljs-string">"res/hd"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
			} <span class="hljs-keyword">else</span> {
				setResourceDir(<span class="hljs-string">"res/sd"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">.5</span>);
			}
		}
	}

	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._resourceDir;
};</pre></div>
        
      
        
        <h3 id="app-scale">App.scale</h3>
<p>Scale a number by a factor based on the screen size.</p>

        
          <div class='highlight'><pre>App.scale = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(floatValue)</span> {</span>
	<span class="hljs-keyword">return</span> floatValue * <span class="hljs-keyword">this</span>._scaleFactor;
};</pre></div>
        
      
        
        <h3 id="app-centralize">App.centralize</h3>
<p>Return a point relative to the center of the screen and scaled.</p>

        
          <div class='highlight'><pre>App.centralize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x, y)</span> {</span>
	<span class="hljs-keyword">var</span> winSize = <span class="hljs-keyword">this</span>.getWinSize();
	<span class="hljs-keyword">return</span> cc.p(<span class="hljs-keyword">this</span>.scale(x) + winSize.width * <span class="hljs-number">.5</span>,
		<span class="hljs-keyword">this</span>.scale(y) + winSize.height * <span class="hljs-number">.5</span>);
};</pre></div>
        
      
        
        <h3 id="app-alert">App.alert</h3>
<p>Safely call <code>alert</code>.</p>

        
          <div class='highlight'><pre>App.alert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(msg)</span> {</span>
	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> alert === <span class="hljs-string">"function"</span>) {
		alert(msg);
	} <span class="hljs-keyword">else</span> {
		cc.log(msg);
	}
};</pre></div>
        
      
        
        <h3 id="app-assert">App.assert</h3>
<p>Throw an error if the given object is undefined or boolean is false.</p>

        
          <div class='highlight'><pre>App.assert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(objOrBool, errMsg)</span> {</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> objOrBool === <span class="hljs-string">"undefined"</span>
	|| (<span class="hljs-keyword">typeof</span> objOrBool === <span class="hljs-string">"boolean"</span> &amp;&amp; !objOrBool)
	) {
		errMsg = errMsg || <span class="hljs-string">"Couldn't load the game. Please try a newer browser."</span>;
		alert(errMsg);
		debugger;
		<span class="hljs-keyword">throw</span> errMsg;
	}
};</pre></div>
        
      
        
        <h3 id="app-clone">App.clone</h3>
<p>Clone an object or array so the original can remained unchanged. If passed an undefined value, an empty array is returned.</p>

        
          <div class='highlight'><pre>App.clone = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> {</span>
	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">"undefined"</span>) {
		<span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(obj));
	}
	<span class="hljs-keyword">return</span> [];
};</pre></div>
        
      
        
        <h3 id="app-localizecurrency">App.localizeCurrency</h3>
<p>Return the currency amount localized. Currently the method only localizes to the United States currency format.</p>

        
          <div class='highlight'><pre>App.localizeCurrency = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(amount)</span> {</span>
	<span class="hljs-keyword">return</span> <span class="hljs-string">"$"</span> + <span class="hljs-built_in">parseFloat</span>(amount).toFixed(<span class="hljs-number">2</span>);
};</pre></div>
        
      
        
        <h3 id="app-getlanguagecode">App.getLanguageCode</h3>
<p>Return the current language code. Example: <code>en</code>.</p>

        
          <div class='highlight'><pre>App.getLanguageCode = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> strings;
	
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._language === <span class="hljs-string">"undefined"</span>) {
		<span class="hljs-keyword">this</span>._language = cc.sys.language;

		strings = App.config[<span class="hljs-string">"strings"</span>];
		<span class="hljs-keyword">if</span> (strings &amp;&amp; <span class="hljs-keyword">typeof</span> strings[<span class="hljs-keyword">this</span>._language] === <span class="hljs-string">"undefined"</span>) {
			cc.log(<span class="hljs-string">"Don't have strings for language: "</span> + <span class="hljs-keyword">this</span>._language);
			<span class="hljs-keyword">this</span>._language = <span class="hljs-string">"en"</span>;
		}
	}
	
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._language;
};</pre></div>
        
      
        
        <h3 id="app-getlocalizedstring">App.getLocalizedString</h3>
<p>Lookup and return a localized string. Configure localized strings in <code>App.config[&quot;strings&quot;][languageCode]</code>.</p>

        
          <div class='highlight'><pre>App.getLocalizedString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span> {</span>
	<span class="hljs-keyword">var</span> strings,
		code = <span class="hljs-keyword">this</span>.getLanguageCode();
	
	strings = App.config[<span class="hljs-string">"strings"</span>][code];
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> strings[key] !== <span class="hljs-string">"undefined"</span>) {
		<span class="hljs-keyword">return</span> strings[key];
	}
	<span class="hljs-keyword">if</span> (key &amp;&amp; key.length) {
		cc.log(<span class="hljs-string">"Couldn't find string["</span> + code + <span class="hljs-string">"]["</span> + key + <span class="hljs-string">"]"</span>);
	}
	<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
};</pre></div>
        
      
        
        <h3 id="app-getrunninglayer">App.getRunningLayer</h3>
<p>Returns the running scene’s child layer.</p>
<p>Scenes can create a member variable named <code>layer</code> which will be used by this method.</p>

        
          <div class='highlight'><pre>App.getRunningLayer = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> node = cc.director.getRunningScene();
	<span class="hljs-keyword">if</span> (node) {
		<span class="hljs-keyword">if</span> (node.layer) {
			node = node.layer;
		}
	}
	<span class="hljs-keyword">return</span> node;
};</pre></div>
        
      
        
        <h3 id="app-callrunninglayer">App.callRunningLayer</h3>
<p>Call the running scene’s layer’s method.</p>

        
          <div class='highlight'><pre>App.callRunningLayer = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(methodName, param1, param2, param3)</span> {</span>
	<span class="hljs-keyword">var</span> layer = <span class="hljs-keyword">this</span>.getRunningLayer();
	<span class="hljs-keyword">if</span> (layer[methodName]) {
		layer[methodName](param1, param2, param3);
	} <span class="hljs-keyword">else</span> {
		cc.log(<span class="hljs-string">"Couldn't find method '"</span> + methodName + <span class="hljs-string">"' in running scene or layer."</span>);
	}
};</pre></div>
        
      
        
        <h3 id="app-getresourcestopreload">App.getResourcesToPreload</h3>
<p>Return an array of files to preload.</p>

        
          <div class='highlight'><pre>App.getResourcesToPreload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> dir = <span class="hljs-keyword">this</span>.getResourceDir(),
		files = App.config[<span class="hljs-string">"preload"</span>],
		ret = [],
		i;

	<span class="hljs-keyword">if</span> (files) {
		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; files.length; i += <span class="hljs-number">1</span>) {
			<span class="hljs-keyword">if</span> (files[i] &amp;&amp; files[i].length) {
				ret[i] = dir + <span class="hljs-string">"/"</span> + files[i];
			}
		}
	} <span class="hljs-keyword">else</span> {
		cc.log(<span class="hljs-string">"Missing App.config.preload array"</span>);
	}
	
	<span class="hljs-keyword">return</span> ret;
};</pre></div>
        
      
        
        <h3 id="app-loadresources">App.loadResources</h3>
<p>Setup and load resources.</p>

        
          <div class='highlight'><pre>App.loadResources = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> sheets = App.config[<span class="hljs-string">"spritesheets"</span>],
		sheet,
		i;

	cc.loader.resPath = <span class="hljs-keyword">this</span>.getResourceDir();
	cc.director.setContentScaleFactor(<span class="hljs-keyword">this</span>._contentScaleFactor);

	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; sheets.length; i += <span class="hljs-number">1</span>) {
		sheet = cc.loader.getUrl(sheets[i]);
		cc.log(<span class="hljs-string">"Loading spritesheet: "</span> + sheet);
		cc.spriteFrameCache.addSpriteFrames(sheet);
	}
};</pre></div>
        
      
        
        <h3 id="app-runinitialscene">App.runInitialScene</h3>
<p>Loads resources and calls the initial scene. Called by <code>App.main</code>.</p>

        
          <div class='highlight'><pre>App.runInitialScene = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> Scene = App.getInitialScene(),
		scene;
	
	App.loadResources();
	scene = <span class="hljs-keyword">new</span> Scene;
	scene.init();
	cc.director.runScene(scene);
};</pre></div>
        
      
        
        <h3 id="app-isfullscreenavailable">App.isFullscreenAvailable</h3>
<p>Return true if fullscreen mode is available on this platform.</p>

        
          <div class='highlight'><pre>App.isFullscreenAvailable = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.isHtml5() || <span class="hljs-keyword">this</span>.isDesktop();
};</pre></div>
        
      
        
        <h3 id="app-isfullscreenenabled">App.isFullscreenEnabled</h3>
<p>Return true if fullscreen mode is enabled.</p>

        
          <div class='highlight'><pre>App.isFullscreenEnabled = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._fullscreenEnabled ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
};</pre></div>
        
      
        
        <h3 id="app-enablefullscreen">App.enableFullscreen</h3>
<p>Enable or disable fullscreen mode.</p>

        
          <div class='highlight'><pre>App.enableFullscreen = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(enabled)</span> {</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isFullscreenAvailable()) {
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isHtml5()) {
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isFullscreenEnabled()) {
				<span class="hljs-comment">/*cc.log("Cancelling fullscreen");*/</span>
				<span class="hljs-keyword">this</span>.runPrefixMethod(
					document,
					<span class="hljs-string">"CancelFullScreen"</span>
				);
			}
			<span class="hljs-keyword">else</span> {
				<span class="hljs-comment">/*cc.log("Requesting fullscreen");*/</span>
				<span class="hljs-keyword">this</span>.runPrefixMethod(
					document.getElementById(<span class="hljs-string">"gameBody"</span>),
					<span class="hljs-string">"RequestFullScreen"</span>
				);
			}
		}
	}

	<span class="hljs-keyword">this</span>._fullscreenEnabled = enabled ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
	<span class="hljs-comment">/*cc.log("Is fullscreen? " + this.isFullscreenEnabled());*/</span>
};</pre></div>
        
      
        
        <h3 id="app-togglefullscreenenabled">App.toggleFullscreenEnabled</h3>
<p>Toggle whether fullscreen is enabled.</p>

        
          <div class='highlight'><pre>App.toggleFullscreenEnabled = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">this</span>.enableFullscreen(!<span class="hljs-keyword">this</span>.isFullscreenEnabled());
};</pre></div>
        
      
        
        <h3 id="app-runprefixmethod">App.runPrefixMethod</h3>
<p>Run a method name prefixed according to the browser. Example: <code>RequestFullScreen</code> becomes <code>webkitRequestFullScreen</code>.</p>
<p>See <a href="http://www.sitepoint.com/html5-full-screen-api/">http://www.sitepoint.com/html5-full-screen-api/</a>.</p>

        
          <div class='highlight'><pre>App.runPrefixMethod = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj, method)</span> {</span>
	<span class="hljs-keyword">var</span> pfx = [<span class="hljs-string">"webkit"</span>, <span class="hljs-string">"moz"</span>, <span class="hljs-string">"ms"</span>, <span class="hljs-string">"o"</span>, <span class="hljs-string">""</span>];
	<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>, m, t;
	<span class="hljs-keyword">while</span> (p &lt; pfx.length &amp;&amp; !obj[m]) {
		m = method;
		<span class="hljs-keyword">if</span> (pfx[p] == <span class="hljs-string">""</span>) {
			m = m.substr(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>).toLowerCase() + m.substr(<span class="hljs-number">1</span>);
		}
		m = pfx[p] + m;
		t = <span class="hljs-keyword">typeof</span> obj[m];
		<span class="hljs-keyword">if</span> (t != <span class="hljs-string">"undefined"</span>) {
			pfx = [pfx[p]];
			<span class="hljs-keyword">return</span> (t == <span class="hljs-string">"function"</span> ? obj[m]() : obj[m]);
		}
		p++;
	}
};</pre></div>
        
      
        
        <h3 id="app-loadsoundenabled">App.loadSoundEnabled</h3>
<p>Load the <code>soundEnabled</code> preference from local storage.</p>

        
          <div class='highlight'><pre>App.loadSoundEnabled = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> enabled = cc.sys.localStorage.getItem(<span class="hljs-string">"soundEnabled"</span>);
	<span class="hljs-comment">/*cc.log("Loaded sound enabled: " + enabled);*/</span>
	
	<span class="hljs-keyword">if</span> (enabled === <span class="hljs-literal">null</span> || enabled === <span class="hljs-string">""</span>) {
		<span class="hljs-keyword">this</span>.enableSound(<span class="hljs-literal">true</span>);
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">this</span>._soundEnabled = (enabled === <span class="hljs-string">"true"</span> || enabled === <span class="hljs-literal">true</span>);
	}
	<span class="hljs-comment">/*cc.log("Sound enabled is now: " + this._soundEnabled);*/</span>
};</pre></div>
        
      
        
        <h3 id="app-enablesound">App.enableSound</h3>
<p>Enable or disable sound.</p>

        
          <div class='highlight'><pre>App.enableSound = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(enabled)</span> {</span>
	<span class="hljs-keyword">this</span>._soundEnabled = enabled ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
	cc.sys.localStorage.setItem(<span class="hljs-string">"soundEnabled"</span>, <span class="hljs-keyword">this</span>._soundEnabled);
	<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isSoundEnabled()) {
		cc.audioEngine.stopMusic();
	}
};</pre></div>
        
      
        
        <h3 id="app-togglesoundenabled">App.toggleSoundEnabled</h3>
<p>Toggle whether sound is enabled.</p>

        
          <div class='highlight'><pre>App.toggleSoundEnabled = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">this</span>.enableSound(!<span class="hljs-keyword">this</span>.isSoundEnabled());
};</pre></div>
        
      
        
        <h3 id="app-issoundenabled">App.isSoundEnabled</h3>
<p>Return true if sound is enabled.</p>

        
          <div class='highlight'><pre>App.isSoundEnabled = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._soundEnabled ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
};</pre></div>
        
      
        
        <h3 id="app-playeffect">App.playEffect</h3>
<p>Plays the sound effect with the given filename if sound is enabled.</p>

        
          <div class='highlight'><pre>App.playEffect = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(filename)</span> {</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isSoundEnabled()) {
		cc.audioEngine.playEffect(filename);
	}
};</pre></div>
        
      
        
        <h3 id="app-playmusic">App.playMusic</h3>
<p>Plays the music file with the given filename if sound is enabled.</p>

        
          <div class='highlight'><pre>App.playMusic = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(filename)</span> {</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isSoundEnabled()) {
		cc.audioEngine.playMusic(filename);
	}
};</pre></div>
        
      
        
        <h3 id="app-getanalyticsplugin">App.getAnalyticsPlugin</h3>
<p>Get the analytics plugin. The first time this is called, the plugin is loaded and configured.</p>

        
          <div class='highlight'><pre>App.getAnalyticsPlugin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
		name,
		p;

	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._analyticsPlugin === <span class="hljs-string">"undefined"</span>) {
		<span class="hljs-keyword">this</span>._loadAnalyticsTries = (<span class="hljs-keyword">this</span>._loadAnalyticsTries || <span class="hljs-number">0</span>);
		
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> FlurryAgent !== <span class="hljs-string">"undefined"</span> &amp;&amp;
			<span class="hljs-keyword">typeof</span> App.config !== <span class="hljs-string">"undefined"</span> &amp;&amp;
			!<span class="hljs-keyword">this</span>._initializedAnalytics
		) {
			<span class="hljs-keyword">this</span>._initializedAnalytics = <span class="hljs-literal">true</span>;
			<span class="hljs-comment">/*cc.log("Loading analytics plugin after "
				+ this._loadAnalyticsTries + " tries");*/</span>

			name = App.config[<span class="hljs-string">"analytics-plugin-name"</span>];
			<span class="hljs-keyword">if</span> (apiKey &amp;&amp; manager &amp;&amp; name) {
				p = plugin.PluginManager.getInstance().loadPlugin(name);
				<span class="hljs-keyword">if</span> (p) {
					p.setDebugMode(App.config[<span class="hljs-string">"analytics-plugin-debug"</span>]);
					p.startSession(App.config[<span class="hljs-string">"analytics-plugin-api-key"</span>]);
					<span class="hljs-keyword">this</span>._analyticsPlugin = p;
				}
			} <span class="hljs-keyword">else</span> {
				cc.log(<span class="hljs-string">"Analytics plugin: API key has not been set"</span>);
			}
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-comment">/* Try to load plugin up to 10 times with a 250ms delay between tries. */</span>
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._loadAnalyticsTries &lt; <span class="hljs-number">10</span>) {
				setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
					self.getAnalyticsPlugin();
				}, <span class="hljs-number">250</span>);
			}
		}

		<span class="hljs-keyword">this</span>._loadAnalyticsTries = <span class="hljs-keyword">this</span>._loadAnalyticsTries + <span class="hljs-number">1</span>;
	}
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._analyticsPlugin;
};</pre></div>
        
      
        
        <h3 id="app-getadsplugin">App.getAdsPlugin</h3>
<p>Get the advertisements plugin. The first time this is called, the plugin is loaded and configured.</p>

        
          <div class='highlight'><pre>App.getAdsPlugin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._adsPlugin === <span class="hljs-string">"undefined"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> plugin !== <span class="hljs-string">"undefined"</span>) {
		<span class="hljs-keyword">var</span> name = App.config[<span class="hljs-string">"ads-plugin-name"</span>];

		<span class="hljs-keyword">this</span>._adsPlugin = plugin.PluginManager.getInstance().loadPlugin(name);
		
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._adsPlugin === <span class="hljs-literal">null</span>) {
			<span class="hljs-keyword">this</span>._adsPlugin = <span class="hljs-keyword">new</span> plugin[name]();
			<span class="hljs-keyword">this</span>._adsPlugin.init();
		}
		
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._adsPlugin) {
			<span class="hljs-keyword">this</span>._adsPlugin.setDebugMode(App.config[<span class="hljs-string">"ads-plugin-debug"</span>]);
			<span class="hljs-keyword">this</span>._adsPlugin.configDeveloperInfo({
				apiKey: App.config[<span class="hljs-string">"ads-plugin-api-key"</span>],
				mode: App.config[<span class="hljs-string">"ads-plugin-mode"</span>]
			});
		}
	}

	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._adsPlugin;
};</pre></div>
        
      
        
        <h3 id="app-getsocialplugin">App.getSocialPlugin</h3>
<p>Get the social networking plugin. The first time this is called, the plugin is loaded and configured.</p>

        
          <div class='highlight'><pre>App.getSocialPlugin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> name;
	
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._socialPlugin === <span class="hljs-string">"undefined"</span>) {
		name = App.config[<span class="hljs-string">"social-plugin-name"</span>];
		<span class="hljs-keyword">if</span> (plugin[name]) {
			<span class="hljs-keyword">this</span>._socialPlugin = <span class="hljs-keyword">new</span> plugin[name]();
			<span class="hljs-keyword">this</span>._socialPlugin.setDebugMode(App.config[<span class="hljs-string">"social-plugin-debug"</span>]);
			<span class="hljs-keyword">this</span>._socialPlugin.init({
				appId: App.config[<span class="hljs-string">"social-plugin-app-id"</span>],
				xfbml: <span class="hljs-literal">false</span>,
				status: <span class="hljs-literal">true</span>,
				cookie: <span class="hljs-literal">true</span>
			});
		}
	}

	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._socialPlugin;
};</pre></div>
        
      
        
        <h3 id="app-geteconomyplugin">App.getEconomyPlugin</h3>
<p>Get the virtual economy plugin. The first time this is called, the plugin is loaded and configured.</p>

        
          <div class='highlight'><pre>App.getEconomyPlugin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._economyPlugin === <span class="hljs-string">"undefined"</span>) {
		<span class="hljs-keyword">var</span> storeConfig = {
				soomSec: App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"secret1"</span>],
				customSecret: App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"secret2"</span>],
				androidPublicKey: App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"android-public-key"</span>]
			};
		
		<span class="hljs-keyword">this</span>._economyPlugin = Soomla;
		
		<span class="hljs-keyword">if</span> (Soomla.CCSoomlaNdkBridge.setDebug) {
			Soomla.CCSoomlaNdkBridge.setDebug(App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"debug"</span>]);
		}

		<span class="hljs-keyword">if</span> (storeConfig &amp;&amp; storeConfig.soomSec &amp;&amp; storeConfig.customSecret) {
			<span class="hljs-keyword">try</span>{
				Soomla.StoreController.createShared(App.getStoreAssets(), storeConfig);
			} <span class="hljs-keyword">catch</span>(e) {
				cc.log(<span class="hljs-string">"Error creating store or getting store assets: "</span> + e);
			}

			Soomla.CCSoomlaNdkBridge.buy = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(
				productId,
				successCallback,
				failureCallback
			)</span> {</span>
				<span class="hljs-keyword">var</span> social = App.getSocialPlugin();
				<span class="hljs-keyword">if</span> (social &amp;&amp; social.isCanvasMode()) {
					social.buy(productId, successCallback, failureCallback);
				}
				<span class="hljs-keyword">else</span> {
					App.alert(<span class="hljs-string">"Please play within Facebook to enable purchasing."</span>);
					Soomla.CCSoomlaNdkBridge.onPaymentComplete();
				}
			};

			Soomla.CCSoomlaNdkBridge.onCurrencyUpdate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				App.getRunningLayer().onCurrencyUpdate();
			};

			Soomla.CCSoomlaNdkBridge.onPaymentComplete = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				App.getRunningLayer().onPaymentComplete();
			};
		} <span class="hljs-keyword">else</span> {
			cc.log(<span class="hljs-string">"Soomla: Secret keys have not been set"</span>);
		}
	}
	
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._economyPlugin;
};</pre></div>
        
      
        
        <h3 id="app-getstoreassets">App.getStoreAssets</h3>
<p>Returns the store assets object. Configured in <code>App.config[&quot;economy-plugin&quot;]</code>.</p>

        
          <div class='highlight'><pre>App.getStoreAssets = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> i,
		a,
		assets = {
			categories: [],
			currencies: [],
			currencyPacks: [],
			goods: {
				singleUse: [],
				lifetime: [],
				equippable: [],
				goodUpgrades: [],
				goodPacks: []
			},
			nonConsumables: [],
			version: <span class="hljs-number">1</span>
		},
		processItems = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> {</span>
			<span class="hljs-keyword">var</span> key,
				func;
			
			key = <span class="hljs-string">"create_market_item"</span>;
			<span class="hljs-keyword">if</span> (obj[key]) {
				func = Soomla.Models.PurchaseWithMarket.createWithMarketItem;
				obj.purchasableItem = func(obj[key][<span class="hljs-number">0</span>], obj[key][<span class="hljs-number">1</span>]);
				<span class="hljs-keyword">delete</span> obj[key];
			}

			key = <span class="hljs-string">"create_virtual_item"</span>;
			<span class="hljs-keyword">if</span> (obj[key]) {
				func = Soomla.Models.PurchaseWithVirtualItem.create;
				obj.purchasableItem = func({
					pvi_itemId: obj[key][<span class="hljs-number">0</span>],
					pvi_amount: obj[key][<span class="hljs-number">1</span>]
				});
				<span class="hljs-keyword">delete</span> obj[key];
			}

			key = <span class="hljs-string">"create_nonconsumable_item"</span>;
			<span class="hljs-keyword">if</span> (obj[key]) {
				func = Soomla.Models.PurchaseWithMarket.create;
				obj.purchasableItem = func({
					marketItem: Soomla.Models.MarketItem.create({
						productId: obj[key][<span class="hljs-number">0</span>],
						consumable: <span class="hljs-number">0</span>,
						price: obj[key][<span class="hljs-number">1</span>]
					})
				});
				<span class="hljs-keyword">delete</span> obj[key];
			}
			
			<span class="hljs-keyword">return</span> obj;
		};
	
	<span class="hljs-comment">/* Currencies. */</span>
	a = App.clone(App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"currencies"</span>]);
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; a.length; i += <span class="hljs-number">1</span>) {
		assets.currencies.push(
			Soomla.Models.VirtualCurrency.create(a[i])
		);
	}
	
	<span class="hljs-comment">/* Currency packs. */</span>
	a = App.clone(App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"currency-packs"</span>]);
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; a.length; i += <span class="hljs-number">1</span>) {
		assets.currencyPacks.push(
			Soomla.Models.VirtualCurrencyPack.create(processItems(a[i]))
		);
	}

	<span class="hljs-comment">/* Single-use goods. */</span>
	a = App.clone(App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"single-use-goods"</span>]);
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; a.length; i += <span class="hljs-number">1</span>) {
		assets.goods.singleUse.push(
			Soomla.Models.SingleUseVG.create(processItems(a[i]))
		);
	}
	
	<span class="hljs-comment">/* Lifetime goods. */</span>
	a = App.clone(App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"lifetime-goods"</span>]);
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; a.length; i += <span class="hljs-number">1</span>) {
		assets.goods.lifetime.push(
			Soomla.Models.LifetimeVG.create(processItems(a[i]))
		);
	}

	<span class="hljs-comment">/* Equippable goods. */</span>
	a = App.clone(App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"equippable-goods"</span>]);
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; a.length; i += <span class="hljs-number">1</span>) {
		assets.goods.equippable.push(
			Soomla.Models.EquippableVG.create(processItems(a[i]))
		);
	}

	<span class="hljs-comment">/* Good upgrades. */</span>
	a = App.clone(App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"good-upgrades"</span>]);
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; a.length; i += <span class="hljs-number">1</span>) {
		assets.goods.goodUpgrades.push(
			Soomla.Models.UpgradeVG.create(processItems(a[i]))
		);
	}

	<span class="hljs-comment">/* Good packs. */</span>
	a = App.clone(App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"good-packs"</span>]);
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; a.length; i += <span class="hljs-number">1</span>) {
		assets.goods.goodPacks.push(
			Soomla.Models.SingleUsePackVG.create(processItems(a[i]))
		);
	}

	<span class="hljs-comment">/* Non-consumables. */</span>
	a = App.clone(App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"non-consumables"</span>]);
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; a.length; i += <span class="hljs-number">1</span>) {
		assets.nonConsumables.push(
			Soomla.Models.NonConsumableItem.create(processItems(a[i]))
		);
	}
	
	<span class="hljs-comment">/* Categories. */</span>
	a = App.clone(App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"categories"</span>]);
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; a.length; i += <span class="hljs-number">1</span>) {
		assets.categories.push(
			Soomla.Models.VirtualCategory.create(a[i])
		);
	}

	<span class="hljs-comment">/*cc.log(JSON.stringify(assets));*/</span>
	<span class="hljs-keyword">return</span> Soomla.IStoreAssets.create(assets);
};</pre></div>
        
      
        
        <h3 id="app-giveitem">App.giveItem</h3>
<p>Give the player a certain amount of an item ID. Use a negative amount to take away.</p>

        
          <div class='highlight'><pre>App.giveItem = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(itemId, amount)</span> {</span>
	<span class="hljs-keyword">if</span> (amount &lt; <span class="hljs-number">0</span>) {
		Soomla.storeInventory.takeItem(itemId, <span class="hljs-built_in">Math</span>.abs(amount));
	} <span class="hljs-keyword">else</span> {
		Soomla.storeInventory.giveItem(itemId, amount);
	}
};</pre></div>
        
      
        
        <h3 id="app-isinitiallaunch">App.isInitialLaunch</h3>
<p>Returns true if this is the first time the app is being launched. It determines this based on whether the <code>uuid</code> key exists within local storage. Deleting this key will essentially reset the app into thinking it’s the first run.</p>
<p>Must be called before <code>App.getUUID()</code>, which creates the <code>uuid</code> key.</p>

        
          <div class='highlight'><pre>App.isInitialLaunch = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> v = cc.sys.localStorage.getItem(<span class="hljs-string">"uuid"</span>);
	<span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> v === <span class="hljs-string">"undefined"</span> || v === <span class="hljs-literal">null</span> || v === <span class="hljs-string">""</span>);
};</pre></div>
        
      
        
        <h3 id="app-oninitiallaunch">App.onInitialLaunch</h3>
<p>Called on the App’s first launch. Used to set initial balances of virtual economy currencies.</p>

        
          <div class='highlight'><pre>App.onInitialLaunch = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> i,
		itemId,
		balance,
		initialBalances = App.config[<span class="hljs-string">"economy-plugin"</span>][<span class="hljs-string">"initial-balances"</span>],
		currencies,
		len = <span class="hljs-number">0</span>,
		allZero = <span class="hljs-literal">true</span>;
	
	<span class="hljs-comment">/* Get the currencies. */</span>
	<span class="hljs-keyword">if</span> (Soomla &amp;&amp; Soomla.storeInfo) {
		currencies = Soomla.storeInfo.getVirtualCurrencies();
		len = currencies.length || <span class="hljs-number">0</span>;
	}

	<span class="hljs-comment">/* Determine if inventory is all at zero. */</span>
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i += <span class="hljs-number">1</span>) {
		itemId = currencies[i].itemId;
		balance = Soomla.storeInventory.getItemBalance(itemId);
		<span class="hljs-keyword">if</span> (balance &gt; <span class="hljs-number">0</span>) {
			cc.log(<span class="hljs-string">"User has "</span> + balance + <span class="hljs-string">" of "</span> + itemId);
			allZero = <span class="hljs-literal">false</span>;
			<span class="hljs-keyword">break</span>;
		}
	}
	
	<span class="hljs-comment">/* Set initial balances. */</span>
	<span class="hljs-keyword">if</span> (allZero) {
		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i += <span class="hljs-number">1</span>) {
			itemId = currencies[i].itemId;
			balance = (initialBalances ? initialBalances[itemId] : <span class="hljs-number">0</span>);
			cc.log(<span class="hljs-string">"Setting initial balance "</span> + balance + <span class="hljs-string">" for "</span> + itemId);
			Soomla.storeInventory.giveItem(itemId, balance);
		}
	}
};</pre></div>
        
      
        
        <h3 id="app-getuuid">App.getUUID</h3>
<p>Gets or creates a unique identifier for the current device.</p>

        
          <div class='highlight'><pre>App.getUUID = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(length)</span> {</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._uuid === <span class="hljs-string">"undefined"</span>) {
		<span class="hljs-keyword">this</span>._uuid = cc.sys.localStorage.getItem(<span class="hljs-string">"uuid"</span>) || <span class="hljs-string">""</span>;
		
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._uuid.length === <span class="hljs-number">0</span>) {
			length = length || <span class="hljs-number">32</span>;
			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; length; i += <span class="hljs-number">1</span>) {
				<span class="hljs-keyword">this</span>._uuid += <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">16</span>).toString(<span class="hljs-number">16</span>);
			}
			cc.sys.localStorage.setItem(<span class="hljs-string">"uuid"</span>, <span class="hljs-keyword">this</span>._uuid);
			module.log(<span class="hljs-string">"Generated UUID for the first time: "</span> + <span class="hljs-keyword">this</span>._uuid);
		} <span class="hljs-keyword">else</span> {
			module.log(<span class="hljs-string">"Already had UUID: "</span> + <span class="hljs-keyword">this</span>._uuid);
		}
	}
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._uuid;
};</pre></div>
        
      
        
        <h3 id="app-gethttpqueryparams">App.getHttpQueryParams</h3>
<p>Return the HTTP query’s GET parameters.</p>

        
          <div class='highlight'><pre>App.getHttpQueryParams = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> loc,
		i,
		len,
		query,
		aux;
	
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._GET === <span class="hljs-string">"undefined"</span>) {
		<span class="hljs-keyword">this</span>._GET = {};
		loc = window.location.toString() || <span class="hljs-string">""</span>;
		
		<span class="hljs-keyword">if</span> (loc.indexOf(<span class="hljs-string">"?"</span>) !== -<span class="hljs-number">1</span>) {
			query = loc.replace(<span class="hljs-regexp">/^.*?\?/</span>, <span class="hljs-string">""</span>).split(<span class="hljs-string">"&amp;"</span>);
			len = query.length;

			<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i += <span class="hljs-number">1</span>) {
				aux = <span class="hljs-built_in">decodeURIComponent</span>(query[i]).split(<span class="hljs-string">"="</span>);
				<span class="hljs-keyword">this</span>._GET[aux[<span class="hljs-number">0</span>]] = aux[<span class="hljs-number">1</span>];
			}
		}
	}
	
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._GET;
};</pre></div>
        
      
        
        <h3 id="app-requesturl">App.requestUrl</h3>
<p>Load the given URL and call the callback when finished. If the third parameter <code>binary</code> is truthy, then use binary transfer mode.</p>
<p>Uses <code>XMLHttpRequest</code> (implemented natively on native platforms).</p>

        
          <div class='highlight'><pre>App.requestUrl = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url, callback, binary)</span> {</span>
	<span class="hljs-keyword">var</span> x,
		loc,
		pos;
	<span class="hljs-keyword">if</span> (XMLHttpRequest) {
		x = <span class="hljs-keyword">new</span> XMLHttpRequest();
	} <span class="hljs-keyword">else</span> {
		x = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Microsoft.XMLHTTP"</span>);
	}
	
	<span class="hljs-keyword">if</span> (url.indexOf(<span class="hljs-string">"://"</span>) &lt;= <span class="hljs-number">0</span>) {
		cc.log(<span class="hljs-string">"window.location = "</span> + window.location);
		loc = window.location.toString() || <span class="hljs-string">""</span>;
		pos = loc.indexOf(<span class="hljs-string">"?"</span>);
		<span class="hljs-keyword">if</span> (pos &gt; <span class="hljs-number">0</span>) {
			loc = loc.substring(<span class="hljs-number">0</span>, pos);
		}
		url = loc + url;
	}
	cc.log(<span class="hljs-string">"Requesting URL: "</span> + url);

	<span class="hljs-keyword">if</span> (x != <span class="hljs-literal">null</span>) {
		<span class="hljs-keyword">if</span> (!binary &amp;&amp; x.overrideMimeType) {
			x.overrideMimeType(<span class="hljs-string">"text/xml"</span>);
		}

		<span class="hljs-comment">/* Call the callback when done. */</span>
		x.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
			<span class="hljs-keyword">if</span> (x.readyState == <span class="hljs-number">4</span>) { <span class="hljs-comment">/* 4 == done. */</span>
				<span class="hljs-keyword">var</span> res = (binary ? x.response : x.responseText);
				callback(res || <span class="hljs-string">""</span>, x.statusText);
				<span class="hljs-keyword">if</span> (res) {
					x = <span class="hljs-literal">null</span>;
				}
			}
		};

		<span class="hljs-comment">/* Make the request. */</span>
		x.open(<span class="hljs-string">"GET"</span>, url, <span class="hljs-literal">true</span>);
		<span class="hljs-keyword">if</span> (binary) {
			x.responseType = <span class="hljs-string">"arraybuffer"</span>;
		}
		x.send(<span class="hljs-literal">null</span>);
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">throw</span> <span class="hljs-string">"Your browser does not support XMLHTTPRequest."</span>;
	}
};</pre></div>
        
      
        
        <h3 id="app-between">App.between</h3>
<p>Return the substring of <code>string</code> between <code>prefix</code> and <code>suffix</code>.</p>

        
          <div class='highlight'><pre>App.between = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(string, prefix, suffix)</span> {</span>
	<span class="hljs-keyword">var</span> startPos = string.indexOf(prefix),
		endPos = string.indexOf(suffix, startPos + prefix.length);
	<span class="hljs-keyword">if</span> (startPos &gt; <span class="hljs-number">0</span> &amp;&amp; endPos &gt; <span class="hljs-number">0</span>) {
		startPos += prefix.length;
		<span class="hljs-keyword">return</span> string.substring(startPos, endPos);
	}
	<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
};</pre></div>
        
      
        
        <h3 id="app-insert">App.insert</h3>
<p>Return the given <code>string</code> with <code>insert</code> inserted after <code>after</code>.</p>

        
          <div class='highlight'><pre>App.insert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(string, after, insert)</span> {</span>
	<span class="hljs-keyword">var</span> pos = string.indexOf(after) + after.length;
	<span class="hljs-keyword">if</span> (pos &gt; <span class="hljs-number">0</span>) {
		<span class="hljs-keyword">return</span> string.substr(<span class="hljs-number">0</span>, pos) + insert + string.substr(pos);
	}
	<span class="hljs-keyword">return</span> string;
};</pre></div>
        
      
        
        <h3 id="app-encodeuricomponents">App.encodeURIComponents</h3>
<p>Return a URI string with components encoded given an object of associated key value pairs to encode.</p>

        
          <div class='highlight'><pre>App.encodeURIComponents = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> {</span>
	<span class="hljs-keyword">var</span> ret = <span class="hljs-string">""</span>,
		count = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> o) {
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> o[key] !== <span class="hljs-string">"undefined"</span>) {
			ret += (count === <span class="hljs-number">0</span> ? <span class="hljs-string">"?"</span> : <span class="hljs-string">"&amp;"</span>) +
				key + <span class="hljs-string">"="</span> + <span class="hljs-built_in">encodeURIComponent</span>(o[key]);
			count += <span class="hljs-number">1</span>;
		}
	}
	<span class="hljs-keyword">return</span> ret;
};</pre></div>
        
      
        
        <h3 id="app-loadimage">App.loadImage</h3>
<p>Loads an image asynchronously from the given URL, calling the callback when finished. Different for HTML5 versus native.</p>

        
          <div class='highlight'><pre>App.loadImage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url, callback)</span> {</span>
	<span class="hljs-keyword">if</span> (url.indexOf(<span class="hljs-string">"://"</span>) == <span class="hljs-number">0</span>) {
		cc.log(<span class="hljs-string">"Not a URL: "</span> + url);
		<span class="hljs-keyword">return</span>;
	}
	
	<span class="hljs-comment">/* Load image HTML5. */</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> Image !== <span class="hljs-string">"undefined"</span>) {
		<span class="hljs-keyword">var</span> image = <span class="hljs-keyword">new</span> Image();
		<span class="hljs-comment">/*image.crossOrigin = "Anonymous";*/</span>
		image.src = url;

		<span class="hljs-comment">/*cc.log("Loading image: " + url);*/</span>
		image.addEventListener(<span class="hljs-string">"load"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
			cc.textureCache.cacheImage(url, image);
			<span class="hljs-keyword">this</span>.removeEventListener(<span class="hljs-string">"load"</span>, <span class="hljs-built_in">arguments</span>.callee, <span class="hljs-literal">false</span>);
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">"function"</span>) {
				callback();
			}
		}, <span class="hljs-literal">false</span>);

	<span class="hljs-comment">/* Load image native. */</span>
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-comment">/*cc.log("Loading image from raw data: " + url);*/</span>
		<span class="hljs-keyword">this</span>.requestUrl(url, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response, status)</span> {</span>
			<span class="hljs-keyword">var</span> bytes = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(response);
			App.addImageData(url, bytes);
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">"function"</span>) {
				callback();
			}
		}, <span class="hljs-literal">true</span>);
	}
};</pre></div>
        
      
        
        <h3 id="app-boot">App.boot</h3>
<p>Boot method. Different for HTML5 versus native. Called at the end of this file.</p>

        
          <div class='highlight'><pre>App.boot = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(global)</span> {</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isHtml5()) {
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-comment">/* Ensure plugin is defined. */</span>
		global.plugin = global.plugin || {};
		<span class="hljs-keyword">if</span> (!global.plugin.PluginManager) {
			global.plugin.PluginManager = {
				getInstance:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">return</span> {loadPlugin:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>}}}
			};
		}

		<span class="hljs-comment">/* Implement timers. */</span>
		<span class="hljs-built_in">require</span>(<span class="hljs-string">"js/lib/timers.js"</span>);
		<span class="hljs-keyword">this</span>.timerLoop = makeWindowTimer(global, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ms)</span>{</span>});
		cc.director.getScheduler().scheduleCallbackForTarget(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.timerLoop);
		<span class="hljs-comment">/*setTimeout(function(){cc.log("Confirmed setTimeout() works");}, 3333);*/</span>

		<span class="hljs-comment">/* Location. */</span>
		<span class="hljs-built_in">require</span>(<span class="hljs-string">"js/ConfigServer.js"</span>);
		<span class="hljs-keyword">if</span> (!global.location) {
			global.location = <span class="hljs-string">"http://"</span> + App.serverAddress +
				(App.serverPort ? <span class="hljs-string">":"</span> + App.serverPort : <span class="hljs-string">""</span>) + <span class="hljs-string">"/"</span>;
			<span class="hljs-comment">/*cc.log("Got location: " + window.location);*/</span>
		}
		<span class="hljs-keyword">if</span> (!global.navigator) {
			<span class="hljs-comment">/*http://stackoverflow.com/questions/8579019/how-to-get-the-user-agent-on-ios */</span>
			global.navigator = {
				userAgent: <span class="hljs-string">"Apple-iPhone5C1/1001.525"</span>
			};
		}
		
		<span class="hljs-comment">/* Add some functionality to cc. */</span>
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> cc.DEGREES_TO_RADIANS === <span class="hljs-string">"undefined"</span>) {
			cc.PI = <span class="hljs-built_in">Math</span>.PI;
			cc.RAD = cc.PI / <span class="hljs-number">180</span>;
			cc.DEG = <span class="hljs-number">180</span> / cc.PI;
			cc.DEGREES_TO_RADIANS = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(angle)</span> {</span><span class="hljs-keyword">return</span> angle * cc.RAD;};
			cc.RADIANS_TO_DEGREES = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(angle)</span> {</span><span class="hljs-keyword">return</span> angle * cc.DEG;};
		}
	}

	<span class="hljs-comment">/* Embed main.js. */</span>
	cc.game.onStart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
		App.main();
	};
	cc.game.run();
};</pre></div>
        
      
        
        <h3 id="app-main">App.main</h3>
<p>The main method. Called by <code>cc.game.onStart</code>.</p>

        
          <div class='highlight'><pre>App.main = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> i,
		sheets,
		cacher,
		dirs = [],
		initialLaunch = <span class="hljs-keyword">this</span>.isInitialLaunch();

	<span class="hljs-keyword">this</span>.getUUID();
	<span class="hljs-keyword">this</span>.loadSoundEnabled();

	cc.defineGetterSetter(App, <span class="hljs-string">"winSize"</span>, App.getWinSize);

	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isHtml5()) {
		cc.view.setDesignResolutionSize(
			App.winSize.width,
			App.winSize.height,
			cc.ResolutionPolicy.SHOW_ALL
		);
		cc.view.resizeWithBrowserSize(<span class="hljs-literal">true</span>);

		cc.LoaderScene.preload(App.getResourcesToPreload(), App.runInitialScene, <span class="hljs-keyword">this</span>);

		App.addImageData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>};
	}
	<span class="hljs-keyword">else</span> {
		App.runInitialScene();
	}
	
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isHtml5()) {
		<span class="hljs-keyword">this</span>._fullscreenEnabled = (<span class="hljs-keyword">this</span>.runPrefixMethod(document, <span class="hljs-string">"FullScreen"</span>)
			|| <span class="hljs-keyword">this</span>.runPrefixMethod(document, <span class="hljs-string">"IsFullScreen"</span>));
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._fullscreenEnabled) {
			cc.log(<span class="hljs-string">"Initially fullscreen? "</span> + <span class="hljs-keyword">this</span>.isFullscreenEnabled());
		}
	}

	cc.director.setAnimationInterval(<span class="hljs-number">1.0</span> / <span class="hljs-keyword">this</span>.getTargetFrameRate());
	cc.log(App.winSize.width + <span class="hljs-string">" x "</span> + App.winSize.height
		+ <span class="hljs-string">", resource dir: "</span> + App.getResourceDir()
		+ <span class="hljs-string">", language: "</span> + App.getLanguageCode()
		+ <span class="hljs-string">", "</span> + <span class="hljs-built_in">parseInt</span>(<span class="hljs-number">1.0</span> / cc.director.getAnimationInterval()) + <span class="hljs-string">" fps"</span>);

	<span class="hljs-comment">/* Load plugins. */</span>
	<span class="hljs-keyword">this</span>.getAnalyticsPlugin();
	<span class="hljs-keyword">this</span>.getAdsPlugin();
	<span class="hljs-keyword">this</span>.getSocialPlugin();
	<span class="hljs-keyword">this</span>.getEconomyPlugin();
	
	<span class="hljs-comment">/* Handle initial launch. */</span>
	<span class="hljs-comment">/* Call after loading plugins so initial currency balances can be set. */</span>
	<span class="hljs-comment">/*cc.log("Initial launch: " + initialLaunch);*/</span>
	<span class="hljs-keyword">if</span> (initialLaunch) {
		<span class="hljs-keyword">this</span>.onInitialLaunch();
	}
};</pre></div>
        
      
        
        <h3 id="boot">Boot</h3>
<p>Call <code>App.boot</code> passing in the global variable.</p>

        
          <div class='highlight'><pre>App.boot(<span class="hljs-keyword">this</span>);</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
