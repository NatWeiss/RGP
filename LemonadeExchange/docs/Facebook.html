<!DOCTYPE html>

<html>
<head>
  <title>Facebook.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>Facebook.js</h1>
        

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="App.html">
                    App.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Config.html">
                    Config.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="ConfigServer.html">
                    ConfigServer.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="LayerGame.html">
                    LayerGame.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="LayerMenu.html">
                    LayerMenu.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="LemonadeExchange.html">
                    LemonadeExchange.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Loader.html">
                    Loader.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="SceneMain.html">
                    SceneMain.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="AdsMobFox.html">
                    AdsMobFox.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Facebook.html">
                    Facebook.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Server.html">
                    Server.js
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>

      
        
        
        
      
        
        <p>Implements the Facebook plugin for HTML5 clients. Native clients will supercede this by having already defined <code>plugin.Facebook</code> (see <code>src/facebook</code>).</p>
<p>Uses the module pattern. The object <code>module</code> will contain all private variables used by the plugin. Public methods will be returned by the module and accessible via <code>plugin.Facebook</code>.</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> plugin = plugin || {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> plugin.Facebook === <span class="hljs-string">"undefined"</span>) {

	plugin.Facebook = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
		<span class="hljs-keyword">var</span> logPrefix = <span class="hljs-string">"Facebook: "</span>,
			module = {
				devInfo: {},
				debug: <span class="hljs-literal">false</span>,
				loggedIn: <span class="hljs-literal">false</span>,
				isCanvas: <span class="hljs-literal">false</span>,
				userId: <span class="hljs-string">""</span>
			};</pre></div>
        
      
        
        <h3 id="module-reset">module.reset</h3>
<p>Reset the module’s data. Used initially and when the player logs out.</p>

        
          <div class='highlight'><pre>		module.reset = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			module.playerNames = {<span class="hljs-string">"me"</span>: <span class="hljs-string">"Me"</span>};
			module.playerFirstNames = {<span class="hljs-string">"me"</span>: <span class="hljs-string">"Me"</span>};
			module.playerImageUrls = {<span class="hljs-string">"me"</span>: <span class="hljs-string">""</span>};
			module.friendIds = [];
			module.permissions = <span class="hljs-literal">null</span>;
		};
		
		module.reset();</pre></div>
        
      
        
        <h3 id="module-log">module.log</h3>
<p>Logs the given message to the console if the module has debug mode enabled. Log messages are prefixed with the module’s <code>logPrefix</code>.</p>

        
          <div class='highlight'><pre>		module.log = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(msg)</span> {</span>
			<span class="hljs-keyword">if</span> (module.debug) {
				cc.log(logPrefix + msg);
			}
		};</pre></div>
        
      
        
        <h3 id="module-checkforfb">module.checkForFB</h3>
<p>Returns true if the Facebook SDK has been loaded.</p>

        
          <div class='highlight'><pre>		module.checkForFB = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> FB === <span class="hljs-string">"undefined"</span>) {
				module.log(<span class="hljs-string">"FB unavailable. Please ensure that all.js is being loaded."</span>);
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}
			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
		};</pre></div>
        
      
        
        <h3 id="window-fbasyncinit">window.fbAsyncInit</h3>
<p>Called by Facebook JS SDK when loaded asynchronosly.</p>

        
          <div class='highlight'><pre>		window.fbAsyncInit = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			<span class="hljs-comment">/*module.log("fbAsyncInit");*/</span>
			module.init();
		};</pre></div>
        
      
        
        <h3 id="module-init">module.init</h3>
<p>Intializes the module. Configures Facebook and subscribes to authorization changes. Detects if running within the Facebook canvas.</p>
<p>This method can be called multiple times. It will initialize only once.</p>

        
          <div class='highlight'><pre>		module.init = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> FB !== <span class="hljs-string">"undefined"</span> &amp;&amp; !module.initialized) {
				module.initialized = <span class="hljs-literal">true</span>;

				<span class="hljs-keyword">if</span> (module.devInfo.appId &amp;&amp; module.devInfo.appId.length) {
					<span class="hljs-comment">/* Init. */</span>
					FB.init(module.devInfo);
					module.log(<span class="hljs-string">"Initialized app ID: "</span> + module.devInfo.appId);

					<span class="hljs-comment">/* Subscribe to authorization changes. */</span>
					FB.Event.subscribe(
						<span class="hljs-string">"auth.authResponseChange"</span>,
						module.onCheckLoginStatus
					);
					
					<span class="hljs-comment">/* Detect if running as a Facebook canvas. */</span>
					<span class="hljs-keyword">if</span> (window.name &amp;&amp; window.name.length &gt; <span class="hljs-number">0</span>) {
						FB.Canvas.getPageInfo(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(info)</span>{</span>
							<span class="hljs-keyword">if</span> (info &amp;&amp; info.clientWidth) {
								module.isCanvas = <span class="hljs-literal">true</span>;
								module.canvasInfo = info;
								module.log(<span class="hljs-string">"Canvas mode"</span>);
							}
						});
					}
				} <span class="hljs-keyword">else</span> {
					module.log(<span class="hljs-string">"App ID has not been set"</span>);
				}
			}
		};</pre></div>
        
      
        
        <h3 id="module-oncheckloginstatus">module.onCheckLoginStatus</h3>
<p>Callback used by Facebook whenever the player’s login status changes. Handles cases where the player is logged in, not authorized or not logged in.</p>
<p>If logged in, asynchronous requests will be made to get the player’s info, profile image, friends and current permissions.</p>

        
          <div class='highlight'><pre>		module.onCheckLoginStatus = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> {</span>
			<span class="hljs-keyword">if</span> (response &amp;&amp; response.status === <span class="hljs-string">"connected"</span>) {
				module.log(<span class="hljs-string">"User is authorized, token: "</span> +
					response.authResponse.accessToken.substring(<span class="hljs-number">0</span>,<span class="hljs-number">4</span>) + <span class="hljs-string">"..."</span>);

				<span class="hljs-comment">/* Get my info. */</span>
				<span class="hljs-keyword">if</span> (!module.userId) {
					FB.api(<span class="hljs-string">"/me"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> {</span>
						<span class="hljs-comment">/*module.log("Got /me response: " + JSON.stringify(response));*/</span>
						module.playerNames[<span class="hljs-string">"me"</span>] = response.name;
						module.playerFirstNames[<span class="hljs-string">"me"</span>] = response.first_name;
						module.userId = response.id;
						module.deleteRequests();
						App.callRunningLayer(
							<span class="hljs-string">"onGetMyPlayerName"</span>,
							module.playerFirstNames[<span class="hljs-string">"me"</span>]
						);
					});
				}
				
				<span class="hljs-comment">/* Get my profile image. */</span>
				<span class="hljs-keyword">if</span> (!module.playerImageUrls[<span class="hljs-string">"me"</span>]) {
					module.loadPlayerImage(<span class="hljs-string">"me"</span>);
				}
				
				<span class="hljs-comment">/* Get my friends. */</span>
				<span class="hljs-keyword">if</span> (!module.friendIds.length) {
					FB.api(<span class="hljs-string">"/me/friends?fields=id,name,first_name"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> {</span>
						<span class="hljs-keyword">if</span> (response.data &amp;&amp; response.data.length) {
							module.onGetFriends(response.data);
						}
					});
				}
				
				<span class="hljs-comment">/* Get current permissions. */</span>
				<span class="hljs-keyword">if</span> (!module.permissions) {
					module.getCurrentPermissions();
				}
				
				module.loggedIn = <span class="hljs-literal">true</span>;
			}
			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (response &amp;&amp; response.status === <span class="hljs-string">"not_authorized"</span>) {
				module.log(<span class="hljs-string">"User is not authorized yet"</span>);
				module.loggedIn = <span class="hljs-literal">false</span>;
				module.reset();
			}
			<span class="hljs-keyword">else</span> {
				module.log(<span class="hljs-string">"User is not logged in"</span>);
				module.loggedIn = <span class="hljs-literal">false</span>;
				module.reset();
			}
			<span class="hljs-comment">/*module.log("Logged in? " + module.loggedIn);*/</span>
			
			App.callRunningLayer(<span class="hljs-string">"onGetLoginStatus"</span>, module.loggedIn);
		};</pre></div>
        
      
        
        <h3 id="module-loadplayerimage">module.loadPlayerImage</h3>
<p>Loads a player’s profile image URL, then loads the image and uses <code>cc.textureCache</code> to cache it using the URL as the key.</p>

        
          <div class='highlight'><pre>		module.loadPlayerImage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> {</span>
			<span class="hljs-keyword">var</span> request,
				config = App.config[<span class="hljs-string">"social-plugin"</span>],
				dim = App.scale(config[<span class="hljs-string">"profile-image-width"</span>] || <span class="hljs-number">100</span>);
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.checkForFB()) {
				request = <span class="hljs-string">"/"</span> + id + <span class="hljs-string">"/picture?redirect=0"</span> +
					<span class="hljs-string">"&amp;width="</span> + dim + <span class="hljs-string">"&amp;height="</span> + dim;
				FB.api(request, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> {</span>
					<span class="hljs-keyword">if</span> (response &amp;&amp; response.data &amp;&amp; response.data.url) {
						module.log(<span class="hljs-string">"Got image url "</span> + response.data.url + <span class="hljs-string">" for "</span> + id);
						App.loadImage(response.data.url, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
							module.playerImageUrls[id] = response.data.url;
							App.callRunningLayer(
								<span class="hljs-string">"onPlayerImageLoaded"</span>,
								id,
								module.playerImageUrls[id]
							);
						});
					}
				});
			}
		};</pre></div>
        
      
        
        <h3 id="module-ongetfriends">module.onGetFriends</h3>
<p>Callback used when the player’s friends list is loaded. Parses the friends list, saving IDs and names.</p>

        
          <div class='highlight'><pre>		module.onGetFriends = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(friends)</span> {</span>
			<span class="hljs-keyword">var</span> i,
				len = friends.length,
				friend;
			
			<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i += <span class="hljs-number">1</span>){
				friend = friends[i];
				<span class="hljs-keyword">if</span> (friend.id) {
					module.friendIds.push(friend.id);
					<span class="hljs-keyword">if</span> (friend.name) {
						module.playerNames[friend.id] = friend.name;
					}
					<span class="hljs-keyword">if</span> (friend.first_name) {
						module.playerFirstNames[friend.id] = friend.first_name;
					}
				}
			}
			module.log(<span class="hljs-string">"Parsed "</span> + module.friendIds.length + <span class="hljs-string">" friends"</span>);
		};</pre></div>
        
      
        
        <h3 id="module-deleterequests">module.deleteRequests</h3>
<p>Deletes any pending invitation requests. The requests are passed from Facebook when a player is responding to an invitation request and look something like <a href="https://apps.facebook.com/your-app-name/?fb_source=notification&amp;request_ids=221921991333209%2C1426088330967926&amp;ref=notif&amp;app_request_type=user_to_user&amp;notif_t=app_invite">this</a>.</p>

        
          <div class='highlight'><pre>		module.deleteRequests = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			<span class="hljs-keyword">var</span> i,
				len,
				gets,
				requestIds;

			gets = App.getHttpQueryParams();
			<span class="hljs-keyword">if</span> (gets.request_ids) {
				<span class="hljs-comment">/*module.log("GET: " + JSON.stringify(gets));*/</span>
				requestIds = gets.request_ids.split(<span class="hljs-string">","</span>);
				<span class="hljs-keyword">if</span> (requestIds) {
					len = requestIds.length;
					<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i += <span class="hljs-number">1</span>) {
						module.log(<span class="hljs-string">"Deleting request ID: "</span> + requestIds[i]);
						FB.api(
							requestIds[i] + <span class="hljs-string">"_"</span> + module.userId,
							<span class="hljs-string">"delete"</span>,
							<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> {</span>
								module.log(<span class="hljs-string">"Delete request response "</span> +
									<span class="hljs-built_in">JSON</span>.stringify(response));
							}
						);
					}
				}
			}
		};</pre></div>
        
      
        
        <h3 id="module-getcurrentpermissions">module.getCurrentPermissions</h3>
<p>Requests the player’s current permissions and stores the result.</p>

        
          <div class='highlight'><pre>		module.getCurrentPermissions = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			<span class="hljs-keyword">if</span> (module.checkForFB()) {
				FB.api(<span class="hljs-string">"/me/permissions"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> {</span>
					<span class="hljs-keyword">if</span> (response.data &amp;&amp; response.data.length) {
						module.permissions = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(response.data[<span class="hljs-number">0</span>]));
						module.log(<span class="hljs-string">"Current permissions: "</span> +
							<span class="hljs-built_in">JSON</span>.stringify(module.permissions));
					}
				});
			}
		};</pre></div>
        
      
        
        <h3 id="public-methods">Public Methods</h3>
<p>Here begins the public methods accessible via <code>plugin.Facebook</code>.</p>

        
          <div class='highlight'><pre>		<span class="hljs-keyword">return</span> cc.Class.extend({</pre></div>
        
      
        
        <h3 id="facebook-init">Facebook.init</h3>
<p>Initializes the plugin and configures it with the given info object.</p>

        
          <div class='highlight'><pre>			init: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(devInfo)</span> {</span>
				module.devInfo = devInfo;
				module.init();
			},</pre></div>
        
      
        
        <h3 id="facebook-login">Facebook.login</h3>
<p>Logs the player in with the given <a href="https://developers.facebook.com/docs/facebook-login/permissions">permissions</a>.</p>
<p>Calls the running layer’s <code>onGetLoginStatus</code> method when finished. Calls the running layer’s <code>onGetMyPlayerName</code> method when finished retrieving the current player’s details.</p>

        
          <div class='highlight'><pre>			login: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(permissions)</span> {</span>
				<span class="hljs-keyword">if</span> (module.checkForFB()) {
					module.log(<span class="hljs-string">"Logging in with permissions: "</span> + permissions);
					FB.login(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span>{</span>
						<span class="hljs-keyword">if</span> (response &amp;&amp; !response.authResponse) {
							module.onCheckLoginStatus();
						}
					}, permissions ? {scope: permissions} : <span class="hljs-literal">null</span>);
				}
			},</pre></div>
        
      
        
        <h3 id="facebook-requestpublishpermissions">Facebook.requestPublishPermissions</h3>
<p>Requests the given publishing permissions.</p>

        
          <div class='highlight'><pre>			requestPublishPermissions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(permissions)</span> {</span>
				<span class="hljs-keyword">var</span> i,
					requestingPerms,
					hasAllPermissions = <span class="hljs-literal">true</span>;

				<span class="hljs-keyword">if</span> (!module.checkForFB()) {
					<span class="hljs-keyword">return</span>;
				}
				
				<span class="hljs-keyword">if</span> (!module.permissions) {
					hasAllPermissions = <span class="hljs-literal">false</span>;
				} <span class="hljs-keyword">else</span> {
					requestingPerms = permissions.split(<span class="hljs-string">','</span>);
					<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; requestingPerms.length; i += <span class="hljs-number">1</span>) {
						<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> module.permissions[requestingPerms[i]] === <span class="hljs-string">"undefined"</span>) {
							hasAllPermissions = <span class="hljs-literal">false</span>;
							<span class="hljs-keyword">break</span>;
						}
					}
				}
				
				<span class="hljs-keyword">if</span> (!hasAllPermissions) {
					module.log(<span class="hljs-string">"Requesting additional permissions: "</span> + permissions);
					FB.login(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span>{</span>
						module.getCurrentPermissions();
					}, {scope: permissions});
				} <span class="hljs-keyword">else</span> {
					module.log(<span class="hljs-string">"Already have permissions: "</span> + permissions);
				}
			},</pre></div>
        
      
        
        <h3 id="facebook-logout">Facebook.logout</h3>
<p>Logs the player out.</p>

        
          <div class='highlight'><pre>			logout: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">if</span> (module.checkForFB()) {
					FB.logout(<span class="hljs-literal">null</span>);
				}
			},</pre></div>
        
      
        
        <h3 id="facebook-isloggedin">Facebook.isLoggedIn</h3>
<p>Returns true if the player is logged in.</p>

        
          <div class='highlight'><pre>			isLoggedIn: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">return</span> module.loggedIn;
			},</pre></div>
        
      
        
        <h3 id="facebook-iscanvasmode">Facebook.isCanvasMode</h3>
<p>Returns true if the HTML5 client is running within a Facebook canvas.</p>

        
          <div class='highlight'><pre>			isCanvasMode: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">return</span> module.isCanvas;
			},</pre></div>
        
      
        
        <h3 id="facebook-getplayername">Facebook.getPlayerName</h3>
<p>Returns the player name for the given ID.</p>

        
          <div class='highlight'><pre>			getPlayerName: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> {</span>
				<span class="hljs-keyword">if</span> (!id) {
					id = <span class="hljs-string">"me"</span>;
				}
				<span class="hljs-keyword">return</span> module.playerNames[id];
			},</pre></div>
        
      
        
        <h3 id="facebook-getplayerfirstname">Facebook.getPlayerFirstName</h3>
<p>Returns the player’s first name for the given ID.</p>

        
          <div class='highlight'><pre>			getPlayerFirstName: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> {</span>
				<span class="hljs-keyword">if</span> (!id) {
					id = <span class="hljs-string">"me"</span>;
				}
				<span class="hljs-keyword">return</span> module.playerFirstNames[id];
			},</pre></div>
        
      
        
        <h3 id="facebook-getplayerimageurl">Facebook.getPlayerImageUrl</h3>
<p>Returns the player’s image URL for the given ID.</p>
<p>Calls the running layer’s <code>onGetPlayerImageUrl</code> when complete.</p>

        
          <div class='highlight'><pre>			getPlayerImageUrl: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> {</span>
				<span class="hljs-keyword">if</span> (!id) {
					id = <span class="hljs-string">"me"</span>;
				}
				<span class="hljs-keyword">if</span> (!module.playerImageUrls[id]) {
					module.loadPlayerImage(id);
					<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
				}
				<span class="hljs-keyword">return</span> module.playerImageUrls[id];
			},</pre></div>
        
      
        
        <h3 id="facebook-getrandomfriendid">Facebook.getRandomFriendId</h3>
<p>Returns a random player ID from the list of friends.</p>

        
          <div class='highlight'><pre>			getRandomFriendId: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">var</span> index = App.rand(module.friendIds.length);
				<span class="hljs-keyword">return</span> module.friendIds[index];
			},</pre></div>
        
      
        
        <h3 id="facebook-buy">Facebook.buy</h3>
<p>Attempts to purchase the given product with Facebook Payments. Only works for HTML5 clients running within a Facebook canvas.</p>
<p>See the following <a href="https://developers.facebook.com/docs/concepts/payments/dialog/">reference</a>.</p>

        
          <div class='highlight'><pre>			buy: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(productUrl, successCallback, failureCallback)</span> {</span>
				<span class="hljs-keyword">var</span> responseReceived = <span class="hljs-literal">false</span>,
					responseTimeout = <span class="hljs-number">35</span>;
				
				FB.ui({
					method: <span class="hljs-string">"pay"</span>,
					action: <span class="hljs-string">"purchaseitem"</span>,
					product: productUrl
					<span class="hljs-comment">/* Optional variables. */</span>
					<span class="hljs-comment">/*test_currency: "GBP",*/</span>
					<span class="hljs-comment">/*quantity: 1,*/</span>
					<span class="hljs-comment">/*request_id: 'YOUR_UNIQUE_REQUEST_ID'*/</span>
				}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span>{</span>
					<span class="hljs-keyword">if</span> (!response) {
						<span class="hljs-keyword">return</span>;
					}
					module.log(<span class="hljs-string">"Payment response: "</span> +
						<span class="hljs-built_in">JSON</span>.stringify(response).substring(<span class="hljs-number">0</span>,<span class="hljs-number">64</span>) + <span class="hljs-string">"..."</span>);

					<span class="hljs-keyword">if</span> (response.status === <span class="hljs-string">"completed"</span>) {
						module.log(<span class="hljs-string">"Payment success"</span>);
						successCallback();
						responseReceived = <span class="hljs-literal">true</span>;
					} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(response.status === <span class="hljs-string">"initiated"</span>) {
						<span class="hljs-comment">/* TBD: check payments graph api if this truly succeeded. */</span>
						module.log(<span class="hljs-string">"Payment initiated, granting success"</span>);
						successCallback();
						<span class="hljs-comment">/*responseReceived = false;*/</span>
					} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(response.error_code) {
						module.log(<span class="hljs-string">"Payment failure: "</span> + response.error_message);
						failureCallback();
						responseReceived = <span class="hljs-literal">true</span>;
					} <span class="hljs-keyword">else</span> {
						module.log(<span class="hljs-string">"Not handling payment response status: "</span> +
							response.status);
						failureCallback();
						responseReceived = <span class="hljs-literal">true</span>;
					}
				});

				setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
					<span class="hljs-keyword">if</span> (!responseReceived){
						module.log(<span class="hljs-string">"Did not receive a payment response after "</span> +
							responseTimeout + <span class="hljs-string">"s"</span>);
					}
				}, responseTimeout * <span class="hljs-number">1000</span>);
			},</pre></div>
        
      
        
        <h3 id="facebook-showui">Facebook.showUI</h3>
<p>Shows the Facebook <a href="https://developers.facebook.com/docs/javascript/reference/FB.ui/">UI</a> with the given settings, calling the running layer’s <code>onSocialUIResponse</code> when finished.</p>
<p>Requests dialog reference <a href="https://developers.facebook.com/docs/reference/dialogs/requests/">here</a>.</p>

        
          <div class='highlight'><pre>			showUI: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(infoObj)</span> {</span>
				<span class="hljs-keyword">if</span> (module.checkForFB()) {
					FB.ui(infoObj, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span>{</span>
						App.callRunningLayer(<span class="hljs-string">"onSocialUIResponse"</span>, response);
					});
				}
			},</pre></div>
        
      
        
        <h3 id="facebook-setdebugmode">Facebook.setDebugMode</h3>
<p>Sets debug mode to the given value. In debug mode, messages are logged to the console.</p>

        
          <div class='highlight'><pre>			setDebugMode: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(debug)</span> {</span>
				module.debug = (debug ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>);
			},</pre></div>
        
      
        
        <h3 id="facebook-getsdkversion">Facebook.getSDKVersion</h3>
<p>Returns the Facebook SDK version.</p>

        
          <div class='highlight'><pre>			getSDKVersion: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">if</span> (module.checkForFB() &amp;&amp; FB.getSDKVersion) {
					<span class="hljs-keyword">return</span> FB.getSDKVersion();
				}
				<span class="hljs-keyword">return</span> <span class="hljs-string">"unknown"</span>;
			}
		}); <span class="hljs-comment">// end class extend</span>

	}()); <span class="hljs-comment">// end module</span>

} <span class="hljs-comment">// end if html5</span></pre></div>
        
      

        
          <div>
            <h4>Table of Contents</h4>
            <ol>
              
                
                <li>
                  <a class="source" href="App.html">
                    App.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Config.html">
                    Config.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="ConfigServer.html">
                    ConfigServer.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="LayerGame.html">
                    LayerGame.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="LayerMenu.html">
                    LayerMenu.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="LemonadeExchange.html">
                    LemonadeExchange.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Loader.html">
                    Loader.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="SceneMain.html">
                    SceneMain.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="AdsMobFox.html">
                    AdsMobFox.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Facebook.html">
                    Facebook.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="Server.html">
                    Server.js
                  </a>
                </li>
              
            </ol>
          </div>
        

      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
